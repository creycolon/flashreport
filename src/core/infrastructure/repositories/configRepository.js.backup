import { getDatabase } from '../db/database';

export const configRepository = {
    get: async (key, defaultValue = null) => {
        const db = await getDatabase();
        const result = await db.getFirstAsync('SELECT value FROM app_config WHERE key = ?', [key]);
        return result ? result.value : defaultValue;
    },

    set: async (key, value) => {
        const db = await getDatabase();
        const valueStr = String(value);
        await db.runAsync(
            'INSERT INTO app_config (id, key, value) VALUES (?, ?, ?) ON CONFLICT(key) DO UPDATE SET value = EXCLUDED.value, updated_at = CURRENT_TIMESTAMP',
            [Date.now().toString(), key, valueStr]
        );
        return true;
    }
};
